<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GGRevealer - Poker Hand De-anonymizer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/static/css/styles.css" rel="stylesheet">

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/static/images/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/images/apple-touch-icon.png">
</head>
<body>
    <nav class="navbar navbar-dark navbar-premium">
        <div class="container-fluid">
            <a class="navbar-brand-premium" href="/app">
                <div class="logo-container">
                    <img src="/static/images/logo-icon.png" alt="GGRevealer" class="logo-icon">
                </div>
                <div class="brand-text-container">
                    <span class="brand-text-main">GGRevealer</span>
                    <span class="brand-text-sub">Poker De-anonymizer</span>
                </div>
            </a>
        </div>
    </nav>

    <!-- Main Layout Container with Sidebar -->
    <div class="main-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h5>Navegación</h5>
            </div>

            <nav class="sidebar-nav">
                <a href="#" class="sidebar-link active" id="nav-new-job">
                    <i class="bi bi-plus-circle"></i>
                    <span>Nuevo Job</span>
                </a>
                <a href="#" class="sidebar-link" id="nav-reprocess">
                    <i class="bi bi-arrow-clockwise"></i>
                    <span>Reprocesar</span>
                </a>
                <a href="#" class="sidebar-link" id="nav-history">
                    <i class="bi bi-clock-history"></i>
                    <span>Historial</span>
                </a>
                <a href="#" class="sidebar-link" id="nav-failed-files">
                    <i class="bi bi-exclamation-triangle"></i>
                    <span>Archivos Fallidos</span>
                </a>
            </nav>

            <div class="sidebar-divider"></div>

            <!-- API Key Configuration -->
            <div class="sidebar-section">
                <h6 class="sidebar-section-title">Configuración API</h6>
                <div class="api-key-card">
                    <div class="d-flex align-items-center justify-content-between mb-2">
                        <span class="small">Gemini API Key:</span>
                        <span id="api-key-status" class="badge bg-danger">
                            <i class="bi bi-x-circle"></i> Sin configurar
                        </span>
                    </div>
                    <button class="btn btn-sm btn-outline-secondary w-100" data-bs-toggle="modal" data-bs-target="#apiKeyModal">
                        <i class="bi bi-key"></i> Configurar API Key
                    </button>
                </div>
            </div>

            <div class="sidebar-divider"></div>

            <!-- Budget Summary Card -->
            <div class="sidebar-section">
                <h6 class="sidebar-section-title">Presupuesto Mensual</h6>
                <div class="budget-card">
                    <div class="d-flex justify-content-between mb-2 small">
                        <span>Gastado:</span>
                        <strong id="monthly-spending">$0.00</strong>
                    </div>
                    <div class="progress mb-2" style="height: 20px;">
                        <div id="budget-progress" class="progress-bar bg-success" role="progressbar"
                             style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                            0%
                        </div>
                    </div>
                    <div class="d-flex justify-content-between small text-muted">
                        <span>Límite:</span>
                        <span id="monthly-budget">$200.00</span>
                    </div>
                    <button class="btn btn-sm btn-outline-secondary w-100 mt-2" data-bs-toggle="modal" data-bs-target="#budgetModal">
                        <i class="bi bi-gear"></i> Configurar
                    </button>
                </div>
            </div>

            <div class="sidebar-divider"></div>

            <div class="sidebar-section">
                <h6 class="sidebar-section-title">Jobs Recientes</h6>
                <div id="recent-jobs-list" class="recent-jobs">
                    <div class="text-muted small text-center py-3">
                        Cargando...
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="main-content">
            <div class="container-fluid py-4">
                <div id="welcome-section" class="row">
            <div class="col-12 text-center mb-4">
                <h1>GGRevealer</h1>
                <p class="lead">Desanonimiza tus hand histories de GGPoker usando screenshots de PokerCraft</p>
            </div>

            <div class="col-12 text-center mb-2">
                <div id="size-indicator" class="text-muted small mb-2" style="display: none;">
                    <i class="bi bi-info-circle"></i>
                    Tamaño total: <span id="total-size">0 MB</span> / <span class="text-success">300 MB</span>
                    <span class="mx-2">|</span>
                    Archivos: <span id="total-files">0</span> / <span class="text-success">600</span>
                </div>
            </div>

            <div class="col-12 text-center mb-4">
                <button id="upload-btn" class="btn btn-brand btn-lg" disabled>
                    <i class="bi bi-upload"></i> Subir y Procesar
                </button>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header bg-brand text-white d-flex justify-content-between align-items-center">
                        <span>
                            <i class="bi bi-file-text"></i> Archivos TXT
                        </span>
                        <span class="badge bg-light text-brand" id="txt-count-badge">0 archivos</span>
                    </div>
                    <div class="card-body">
                        <div id="txt-dropzone" class="dropzone">
                            <i class="bi bi-cloud-upload fs-1"></i>
                            <p>Arrastra archivos TXT aquí</p>
                            <p class="text-muted small">o haz click para seleccionar</p>
                            <input type="file" id="txt-input" accept=".txt" multiple hidden>
                        </div>
                        <div id="txt-files-list" class="mt-3"></div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                        <span>
                            <i class="bi bi-image"></i> Screenshots
                        </span>
                        <span class="badge bg-light text-success" id="screenshot-count-badge">0 archivos</span>
                    </div>
                    <div class="card-body">
                        <div id="screenshot-dropzone" class="dropzone">
                            <i class="bi bi-cloud-upload fs-1"></i>
                            <p>Arrastra screenshots aquí</p>
                            <p class="text-muted small">o haz click para seleccionar</p>
                            <input type="file" id="screenshot-input" accept=".png,.jpg,.jpeg" multiple hidden>
                        </div>
                        <div id="screenshot-files-list" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="processing-section" class="row d-none">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <i class="bi bi-hourglass-split"></i> Procesando...
                    </div>
                    <div class="card-body">
                        <div id="processing-status">
                            <div class="d-flex align-items-center mb-3">
                                <div class="spinner-border text-primary me-3" role="status"></div>
                                <div>
                                    <h5 class="mb-0">Procesando archivos</h5>
                                    <p class="text-muted mb-0" id="status-text">Iniciando...</p>
                                </div>
                            </div>

                            <div class="alert alert-warning d-flex align-items-center" role="alert">
                                <i class="bi bi-exclamation-triangle me-2"></i>
                                <div class="flex-grow-1">
                                    <strong>¿Necesitas detener el proceso?</strong> Puedes cancelar este job si subiste archivos incorrectos o cometiste un error.
                                </div>
                            </div>

                            <div class="d-grid gap-2">
                                <button id="cancel-job-btn" class="btn btn-danger">
                                    <i class="bi bi-x-circle"></i> Cancelar Job
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="results-section" class="row d-none">
            <div class="col-12">
                <div class="card border-success mb-3">
                    <div class="card-header bg-success text-white">
                        <i class="bi bi-check-circle"></i> Procesamiento Completado
                    </div>
                    <div class="card-body">
                        <!-- Stats Grid (Always Visible) -->
                        <div id="results-stats" class="mb-4"></div>

                        <!-- Detailed Metrics Grid (NEW) -->
                        <div id="detailed-metrics" class="row mt-4" style="display: none;">
                            <!-- Hand Coverage Card -->
                            <div class="col-md-6 col-lg-4 mb-3">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h6 class="card-title text-muted mb-3">
                                            <i class="bi bi-file-text"></i> Cobertura de Manos
                                        </h6>
                                        <div id="hand-metrics"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Player Mapping Card -->
                            <div class="col-md-6 col-lg-4 mb-3">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h6 class="card-title text-muted mb-3">
                                            <i class="bi bi-people"></i> Mapeo de Jugadores
                                        </h6>
                                        <div id="player-metrics"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Table Resolution Card -->
                            <div class="col-md-6 col-lg-4 mb-3">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h6 class="card-title text-muted mb-3">
                                            <i class="bi bi-table"></i> Resolución de Mesas
                                        </h6>
                                        <div id="table-metrics"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Screenshot Analysis Card -->
                            <div class="col-md-6 col-lg-4 mb-3">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h6 class="card-title text-muted mb-3">
                                            <i class="bi bi-camera"></i> Análisis de Screenshots
                                        </h6>
                                        <div id="screenshot-metrics"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Mapping Strategy Card -->
                            <div class="col-md-6 col-lg-4 mb-3">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h6 class="card-title text-muted mb-3">
                                            <i class="bi bi-shuffle"></i> Estrategia de Mapeo
                                        </h6>
                                        <div id="mapping-metrics"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Download Buttons (Always Visible) -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-start mb-4">
                            <button id="download-btn" class="btn btn-success btn-lg d-none">
                                <i class="bi bi-file-earmark-zip"></i> <span id="download-btn-text">Descargar Exitosos</span>
                            </button>
                            <button id="download-fallidos-btn" class="btn btn-warning btn-lg d-none">
                                <i class="bi bi-file-earmark-zip"></i> Descargar Fallados
                            </button>
                        </div>

                        <hr>

                        <!-- Tabs Navigation -->
                        <ul class="nav nav-tabs" id="resultsTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="files-tab" data-bs-toggle="tab" data-bs-target="#files-tab-pane" type="button" role="tab" aria-controls="files-tab-pane" aria-selected="true">
                                    <i class="bi bi-file-earmark-text"></i> Archivos
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="screenshots-tab" data-bs-toggle="tab" data-bs-target="#screenshots-tab-pane" type="button" role="tab" aria-controls="screenshots-tab-pane" aria-selected="false">
                                    <i class="bi bi-images"></i> Screenshots
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="debug-tab" data-bs-toggle="tab" data-bs-target="#debug-tab-pane" type="button" role="tab" aria-controls="debug-tab-pane" aria-selected="false">
                                    <i class="bi bi-bug"></i> Debug
                                </button>
                            </li>
                        </ul>

                        <!-- Tabs Content -->
                        <div class="tab-content" id="resultsTabContent">
                            <!-- Tab 1: Archivos -->
                            <div class="tab-pane fade show active" id="files-tab-pane" role="tabpanel" aria-labelledby="files-tab" tabindex="0">
                                <div class="pt-3">
                                    <!-- Successful Files Section -->
                                    <div id="successful-files-section" class="alert alert-success d-none">
                                        <h6><i class="bi bi-check-circle"></i> Archivos Exitosos</h6>
                                        <p class="mb-2">Archivos completamente desanonimizados y listos para PokerTracker:</p>
                                        <div id="successful-files-list"></div>
                                    </div>

                                    <!-- Failed Files Section -->
                                    <div id="failed-files-section" class="alert alert-danger d-none">
                                        <h6><i class="bi bi-x-circle"></i> Archivos Fallados</h6>
                                        <p class="mb-2">Los siguientes archivos contienen IDs anónimos sin desanonimizar:</p>
                                        <div id="failed-files-list"></div>
                                        <div class="mt-2">
                                            <small class="text-muted">
                                                <i class="bi bi-info-circle"></i>
                                                Estos archivos NO son compatibles con PokerTracker. Agrega más screenshots para completar el mapeo.
                                            </small>
                                        </div>
                                    </div>

                                    <!-- Unmapped Players Warning -->
                                    <div id="unmapped-players-warning" class="alert alert-warning d-none">
                                        <h6><i class="bi bi-exclamation-triangle"></i> Jugadores Sin Mapear</h6>
                                        <p class="mb-2">Los siguientes jugadores no pudieron ser identificados:</p>
                                        <div id="unmapped-players-list"></div>
                                    </div>

                                    <div class="text-muted text-center py-3" id="no-files-message">
                                        <i class="bi bi-inbox"></i> No hay información de archivos disponible
                                    </div>
                                </div>
                            </div>

                            <!-- Tab 2: Screenshots -->
                            <div class="tab-pane fade" id="screenshots-tab-pane" role="tabpanel" aria-labelledby="screenshots-tab" tabindex="0">
                                <div class="pt-3">
                                    <!-- Screenshot Status -->
                                    <div id="screenshots-status" class="alert alert-info d-none">
                                        <h6><i class="bi bi-images"></i> Estado de Screenshots</h6>
                                        <div id="screenshots-summary"></div>
                                        <button class="btn btn-sm btn-outline-primary mt-2" type="button" data-bs-toggle="collapse" data-bs-target="#screenshotsDetail">
                                            <i class="bi bi-list"></i> Ver Detalles
                                        </button>
                                        <div class="collapse mt-2" id="screenshotsDetail">
                                            <div id="screenshots-list"></div>
                                        </div>
                                    </div>

                                    <div class="text-muted text-center py-3" id="no-screenshots-message">
                                        <i class="bi bi-inbox"></i> No hay información de screenshots disponible
                                    </div>
                                </div>
                            </div>

                            <!-- Tab 3: Debug -->
                            <div class="tab-pane fade" id="debug-tab-pane" role="tabpanel" aria-labelledby="debug-tab" tabindex="0">
                                <div class="pt-3">
                                    <!-- Claude Code Prompt for Partial Errors -->
                                    <div id="partial-error-claude-prompt" class="alert alert-warning d-none">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <h6><i class="bi bi-chat-left-text"></i> Prompt para Claude Code - Ayuda con Errores</h6>
                                            <div>
                                                <button id="regenerate-partial-error-prompt-btn" class="btn btn-sm btn-outline-primary me-2">
                                                    <i class="bi bi-arrow-clockwise"></i> Regenerar
                                                </button>
                                                <button id="copy-partial-error-prompt-btn" class="btn btn-sm btn-outline-dark">
                                                    <i class="bi bi-clipboard"></i> Copiar
                                                </button>
                                            </div>
                                        </div>
                                        <p class="small mb-2">Se detectaron errores durante el procesamiento. Copia este prompt para obtener ayuda de Claude Code:</p>
                                        <div class="border rounded p-3 bg-white" style="font-family: monospace; font-size: 0.875rem; white-space: pre-wrap; max-height: 300px; overflow-y: auto;">
                                            <div id="partial-error-prompt-text"></div>
                                        </div>
                                    </div>

                                    <!-- Debug Section -->
                                    <div id="debug-section" class="alert alert-info d-none">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h6><i class="bi bi-bug"></i> Debugging Info</h6>
                                            <div>
                                                <button id="export-debug-btn" class="btn btn-sm btn-outline-primary me-2">
                                                    <i class="bi bi-download"></i> Exportar Debug JSON
                                                </button>
                                                <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#debugDetail">
                                                    <i class="bi bi-list"></i> Ver Logs
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Export notification -->
                                        <div id="export-notification" class="alert alert-success d-none mb-3" role="alert">
                                            <i class="bi bi-check-circle-fill"></i>
                                            <strong>Archivo guardado en servidor:</strong>
                                            <span id="export-filepath"></span>
                                        </div>

                                        <div class="collapse" id="debugDetail">
                                            <!-- Log level filter -->
                                            <div class="mb-3">
                                                <label class="form-label">Filtrar por nivel:</label>
                                                <div class="btn-group btn-group-sm" role="group" id="log-level-filter">
                                                    <input type="radio" class="btn-check" name="logLevel" id="log-all" value="" checked autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="log-all">Todos</label>

                                                    <input type="radio" class="btn-check" name="logLevel" id="log-debug" value="DEBUG" autocomplete="off">
                                                    <label class="btn btn-outline-info" for="log-debug">DEBUG</label>

                                                    <input type="radio" class="btn-check" name="logLevel" id="log-info" value="INFO" autocomplete="off">
                                                    <label class="btn btn-outline-success" for="log-info">INFO</label>

                                                    <input type="radio" class="btn-check" name="logLevel" id="log-warning" value="WARNING" autocomplete="off">
                                                    <label class="btn btn-outline-warning" for="log-warning">WARNING</label>

                                                    <input type="radio" class="btn-check" name="logLevel" id="log-error" value="ERROR" autocomplete="off">
                                                    <label class="btn btn-outline-danger" for="log-error">ERROR</label>
                                                </div>
                                            </div>

                                            <!-- Logs display -->
                                            <div id="logs-container" class="border rounded p-3 bg-white" style="max-height: 500px; overflow-y: auto; font-family: monospace; font-size: 0.875rem;">
                                                <div class="text-muted">Cargando logs...</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="text-muted text-center py-3" id="no-debug-message">
                                        <i class="bi bi-inbox"></i> No hay información de debug disponible
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr class="mt-4">

                        <!-- Actions -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button id="new-job-btn" class="btn btn-secondary">
                                <i class="bi bi-plus-circle"></i> Nuevo Job
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="error-section" class="row d-none">
            <div class="col-12">
                <div class="card border-danger">
                    <div class="card-header bg-danger text-white">
                        <i class="bi bi-exclamation-triangle"></i> Error
                    </div>
                    <div class="card-body">
                        <p id="error-message"></p>

                        <!-- Claude Code Prompt -->
                        <div id="error-claude-prompt" class="alert alert-warning mt-3">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6><i class="bi bi-chat-left-text"></i> Prompt para Claude Code</h6>
                                <div>
                                    <button id="regenerate-error-prompt-btn" class="btn btn-sm btn-outline-primary me-2">
                                        <i class="bi bi-arrow-clockwise"></i> Regenerar
                                    </button>
                                    <button id="copy-error-prompt-btn" class="btn btn-sm btn-outline-dark">
                                        <i class="bi bi-clipboard"></i> Copiar
                                    </button>
                                </div>
                            </div>
                            <p class="small mb-2">Copia este prompt y pégalo en Claude Code para obtener ayuda:</p>
                            <div class="border rounded p-3 bg-white" style="font-family: monospace; font-size: 0.875rem; white-space: pre-wrap; max-height: 300px; overflow-y: auto;">
                                <div id="error-prompt-text"></div>
                            </div>
                        </div>

                        <button id="retry-btn" class="btn btn-brand">
                            <i class="bi bi-arrow-clockwise"></i> Reintentar
                        </button>
                    </div>
                </div>
            </div>
        </div>

                <div class="row mt-5" id="history-section">
                    <div class="col-12">
                        <h3>Historial de Jobs</h3>
                        <div id="jobs-list"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Main Content -->
    </div>
    <!-- End Main Layout -->

    <!-- Reprocess Modal -->
    <div class="modal fade" id="reprocessModal" tabindex="-1" aria-labelledby="reprocessModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reprocessModalLabel">
                        <i class="bi bi-arrow-clockwise"></i> Reprocesar Job
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="modal-job-id" class="form-label">Job ID</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="modal-job-id" placeholder="Ej: 3" min="1">
                            <button class="btn btn-outline-brand" type="button" id="load-job-info-btn">
                                <i class="bi bi-search"></i> Cargar Info
                            </button>
                        </div>
                    </div>

                    <div id="modal-job-info" class="d-none">
                        <div class="alert alert-info">
                            <h6 class="alert-heading">
                                <i class="bi bi-info-circle"></i> Información del Job #<span id="modal-job-id-display"></span>
                            </h6>
                            <hr>
                            <div id="modal-job-details">
                                <!-- Job details will be populated here -->
                            </div>
                        </div>

                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle"></i>
                            <strong>Advertencia:</strong> Esto limpiará los resultados anteriores y reprocesará el job desde cero.
                        </div>
                    </div>

                    <div id="modal-job-error" class="alert alert-danger d-none">
                        <!-- Error message will be shown here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-warning" id="modal-reprocess-btn" disabled>
                        <i class="bi bi-arrow-clockwise"></i> Reprocesar Job
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- API Key Configuration Modal -->
    <div class="modal fade" id="apiKeyModal" tabindex="-1" aria-labelledby="apiKeyModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="apiKeyModalLabel">
                        <i class="bi bi-key"></i> Configurar Google Gemini API Key
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="api-key-modal-close"></button>
                </div>
                <div class="modal-body">
                    <!-- Introducción -->
                    <div class="alert alert-info mb-4">
                        <h6><i class="bi bi-info-circle"></i> ¿Por qué necesitas una API Key?</h6>
                        <p class="mb-0">GGRevealer usa Google Gemini Vision API para extraer datos de tus screenshots. Necesitas tu propia API Key para procesar archivos.</p>
                    </div>

                    <!-- Paso 1: Obtener API Key Gratis -->
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <strong><i class="bi bi-1-circle"></i> Paso 1: Obtener API Key Gratis</strong>
                        </div>
                        <div class="card-body">
                            <ol class="mb-3">
                                <li>Ve a <a href="https://makersuite.google.com/app/apikey" target="_blank" rel="noopener">
                                    <strong>Google AI Studio</strong></a></li>
                                <li>Haz click en <strong>"Create API key"</strong></li>
                                <li>Copia la API key que aparecerá automáticamente</li>
                                <li>Pégala en el campo de abajo</li>
                            </ol>
                            <div class="alert alert-success mb-0">
                                <i class="bi bi-lightning-fill"></i>
                                <strong>API Key Gratis:</strong> Limitada a <strong>14 requests/minuto</strong>
                                (suficiente para la mayoría de usuarios)
                            </div>
                        </div>
                    </div>

                    <!-- Paso 2: Límites y velocidad -->
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <strong><i class="bi bi-2-circle"></i> Paso 2: ¿Necesitas Más Velocidad?</strong>
                        </div>
                        <div class="card-body">
                            <p class="mb-2">Con la API Key gratis tienes estos tiempos aproximados:</p>
                            <ul class="mb-3">
                                <li><strong>100 screenshots</strong> → ~7 minutos</li>
                                <li><strong>300 screenshots</strong> → ~21 minutos</li>
                                <li><strong>500 screenshots</strong> → ~35 minutos</li>
                            </ul>
                            <p class="text-muted small mb-2"><i class="bi bi-lightning"></i> <strong>Para procesamiento ilimitado (MÁS RÁPIDO):</strong></p>
                            <ol class="small mb-3">
                                <li>Ve a <a href="https://console.cloud.google.com/billing" target="_blank" rel="noopener">
                                    <strong>Google Cloud Console</strong></a></li>
                                <li>Configura tu método de pago (tarjeta de crédito)</li>
                                <li>Tu misma API Key funcionará sin límites</li>
                            </ol>
                            <div class="alert alert-warning mb-0">
                                <i class="bi bi-exclamation-triangle-fill"></i>
                                <small><strong>Nota:</strong> Google ofrece $300 gratis el primer mes.
                                Solo pagarás si usas más del free tier mensual.</small>
                            </div>
                        </div>
                    </div>

                    <!-- Selector de Tier y Input API Key -->
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <strong><i class="bi bi-3-circle"></i> Tu API Key</strong>
                        </div>
                        <div class="card-body">
                            <!-- Radio buttons para tier -->
                            <div class="mb-3">
                                <p class="small text-muted mb-2">
                                    <i class="bi bi-question-circle"></i>
                                    <strong>¿Tienes facturación configurada en tu cuenta de Google?</strong>
                                </p>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="apiTier"
                                           id="tierFree" value="free" checked>
                                    <label class="form-check-label" for="tierFree">
                                        <strong>No</strong> - Usar API Key gratis (14 req/min, procesamiento lento)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="apiTier"
                                           id="tierPaid" value="paid">
                                    <label class="form-check-label" for="tierPaid">
                                        <strong>Sí</strong> - Tengo facturación configurada (sin límites, rápido)
                                    </label>
                                </div>
                            </div>

                            <hr class="my-3">

                            <!-- Input API Key -->
                            <div class="mb-3">
                                <label for="api-key-input" class="form-label"><strong>Pega tu API Key aquí:</strong></label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-key"></i></span>
                                    <input type="password" class="form-control" id="api-key-input"
                                           placeholder="AIzaSy...">
                                    <button class="btn btn-outline-secondary" type="button" id="toggle-api-key-visibility">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Mensajes de validación -->
                            <div id="api-key-error" class="alert alert-danger d-none" role="alert">
                                <!-- Error message will be shown here -->
                            </div>
                            <div id="api-key-success" class="alert alert-success d-none" role="alert">
                                <i class="bi bi-check-circle"></i> API Key validada correctamente
                            </div>
                            <div id="api-key-validating" class="alert alert-warning d-none" role="alert">
                                <div class="d-flex align-items-center">
                                    <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                                    <span>Validando API Key...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-warning" id="clear-api-key-btn">
                        <i class="bi bi-trash"></i> Limpiar
                    </button>
                    <button type="button" class="btn btn-primary" id="save-api-key-btn">
                        <i class="bi bi-check-lg"></i> Validar y Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Budget Configuration Modal -->
    <div class="modal fade" id="budgetModal" tabindex="-1" aria-labelledby="budgetModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="budgetModalLabel">
                        <i class="bi bi-gear"></i> Configurar Presupuesto Mensual
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="budget-input" class="form-label">Presupuesto Mensual (USD)</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="budget-input"
                                   min="0" step="0.01" value="200.00" placeholder="200.00">
                        </div>
                        <div class="form-text">Establece el límite máximo de gasto mensual en API de Gemini</div>
                    </div>
                    <div class="mb-3">
                        <label for="reset-day-input" class="form-label">Día de Reinicio del Presupuesto</label>
                        <select class="form-select" id="reset-day-input">
                            <option value="1" selected>Día 1 del mes</option>
                            <option value="15">Día 15 del mes</option>
                        </select>
                        <div class="form-text">Día del mes en que se reinicia el contador de gastos</div>
                    </div>
                    <div id="budget-error" class="alert alert-danger d-none">
                        <!-- Error message will be shown here -->
                    </div>
                    <div id="budget-success" class="alert alert-success d-none">
                        <i class="bi bi-check-circle"></i> Presupuesto actualizado correctamente
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="save-budget-btn">
                        <i class="bi bi-save"></i> Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>
